<?xml version="1.0" encoding="utf-8"?>
<rdf:RDF
  xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns#'
  xmlns:rdfs='http://www.w3.org/2000/01/rdf-schema#'
  xmlns:redfoot='http://redfoot.net/2005/redfoot#'
  xmlns:server='http://redfoot.net/2005/server#'
  xmlns:session='http://redfoot.net/2005/session#'
  xmlns:browse='http://redfoot.net/2005/browse#'
  xmlns:template='http://redfoot.net/2005/template#'
  xmlns:commands='http://redfoot.net/2005/commands#'
>

  <session:User rdf:about="mailto:chalaschek@gmail.com">
    <rdfs:label>Chris Halaschek-Wiener</rdfs:label>
    <session:hexdigest>84072d8ca1dbe193b29678b88698d3c8</session:hexdigest>
  </session:User>

  <!-- TODO: load these from my "FOAF" info -->
  <session:User rdf:about="mailto:eikeon@eikeon.com">
    <rdfs:label>Daniel Krech</rdfs:label>
    <session:hexdigest>334b473e8c2555d5eb722e0c932df793</session:hexdigest>
  </session:User>

  <rdf:Description rdf:about="http://redfoot.net/2005/redfoot#Globals">
    <redfoot:admin rdf:resource="mailto:chalaschek@gmail.com"/>
    <redfoot:admin rdf:resource="mailto:eikeon@eikeon.com"/>
  </rdf:Description>

  <server:Site rdf:about="">  
    <template:section rdf:resource="/"/>
    <template:section rdf:resource="/browse/"/>
    <server:page_handler rdf:resource="#page"/>
  </server:Site>
  <!-- TODO: clean up what identifier we're using for server:Site instances "" or "data#Site -->
  <rdf:Description rdf:about="data#Site">  
    <rdfs:label>Certus Investments</rdfs:label>
  </rdf:Description>

  <rdf:Description rdf:about="/">
    <rdfs:label>Home</rdfs:label>
    <template:section_rank>0.0</template:section_rank>
  </rdf:Description>

  <rdf:Description rdf:about="/browse/">
    <browse:root rdf:resource="http://qam.eikco.com/quant#Resource"/>
  </rdf:Description>

  <rdf:Description rdf:about="/update_symbols/">
    <template:content>
      <template:Content rdf:ID="update_symbols">
        <rdfs:label>Update Symbols</rdfs:label>
       <rdf:value rdf:datatype="http://redfoot.net/2005/redfoot#Python">
<![CDATA[
import urllib2
import csv

from rdflib import Namespace

QUANT = Namespace(URIRef("quant#", base=request.host))
c = redfoot.get_context(URIRef("#symbols", base=request.host))

class Symbols:
    def __init__(self, name, url):
        self.name = name
        self.url = url
        self.list = []
        self._update(url)
        
    def _update(self, url):
        c.remove((None, None, None))
        f = urllib2.urlopen(url)
        # "Name","Symbol","Market Value (millions)","Description (as filed with the SEC)"

        i = 0
        for row in csv.reader(f):
            if len(row)==4:
                i += 1
                #if i>500:
                #    break
                try:
                    name, symbol, market_value, description = row
                    uri = URIRef("ticker#%s" % symbol.replace("/", "_"), base=request.host)
                    c.add((uri, RDF.type, QUANT.Stock))
                    c.add((uri, QUANT.symbol, Literal(symbol)))
                    c.add((uri, RDFS.label, Literal(name)))
                    c.add((uri, RDFS.comment, Literal(description)))
                    c.add((uri, QUANT.market_value, Literal(market_value)))
                    c.add((uri, QUANT.exchange, Literal(self.name)))
                except Exception, e:
                    redfoot.log.info("%s" % e)
                    
        f.close()

exchanges = []
exchanges.append(Symbols("Nasdaq", "http://www.nasdaq.com/asp/symbols.asp?exchange=Q&start=0"))

#exchanges.append(Symbols("OTCBB", "http://www.nasdaq.com/asp/symbols.asp?exchange=O&start=0"))
#exchanges.append(Symbols("NYSE", "http://www.nasdaq.com/asp/symbols.asp?exchange=N&start=0"))
#exchanges.append(Symbols("AMEX", "http://www.nasdaq.com/asp/symbols.asp?exchange=1&start=0"))

response.write("Symbols updated")
]]>
        </rdf:value>
      </template:Content>
    </template:content>
  </rdf:Description>

  <rdfs:Class rdf:about="quant#Stock">
    <template:content>
      <template:Content rdf:ID="Company">
        <rdfs:label>Company</rdfs:label>
       <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:kid="http://purl.org/kid/ns#"
     kid:strip=""
>
<?python
from rdflib import Namespace

QUANT = Namespace(URIRef("quant#", base=request.host))

uri = request.uri.abstract()

symbol = redfoot.value(uri, QUANT.symbol)

?>
  <p>${redfoot.value(uri, RDFS.comment)}</p>

<img src="http://bigcharts.marketwatch.com/charts/big.chart?symb=${symbol}"></img>

<img src="http://bigcharts.marketwatch.com/charts/big.chart?symb=${symbol}&amp;time=18&amp;freq=9"></img>


</div>
]]>
        </rdf:value>
      </template:Content>
    </template:content>
  </rdfs:Class>

  <template:Template rdf:ID="page">
    <rdfs:label>Quant Template</rdfs:label>
    <template:content rdf:resource="#content"/>
    <template:background_color>#B0C9BE</template:background_color>
    <template:head rdf:resource="https://svn.redfoot.net/trunk/hypercode/templates/classic#head"/>
    <template:css rdf:resource="#css"/>
    <template:title rdf:resource="#title"/>
    <template:shortcut_icon rdf:resource="http://redfoot.net/2002/11/25/favicon.ico"/>
    <template:header rdf:resource="#header"/>
    <template:navigation rdf:resource="#navigation"/>
    <template:user_navigation rdf:resource="#user_navigation"/>
    <template:footer rdf:resource="#footer"/>
    <server:unauthorized_page_handler rdf:resource="#unauthorized_page_handler"/>
    <server:unauthorized_content_handler rdf:resource="#unauthorized_content_handler"/>
    <server:content_type>application/xhtml+xml</server:content_type>
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[<html xmlns="http://www.w3.org/1999/xhtml" xmlns:kid="http://purl.org/kid/ns#">
<?python SERVER = redfoot.namespace("http://redfoot.net/2005/server#")?>
<?python TEMPLATE = redfoot.namespace("http://redfoot.net/2005/template#")?>
<?python
title = redfoot.label(request.uri, None) or redfoot.label(request.uri.abstract(), None) or "-"
?>
  ${display(lookup(TEMPLATE.head))}
  <body>
    <table id="boundary" cellspacing="0px" cellpadding="0px" align="center">
      <tr>
        <td colspan="2">
          <table id="header" cellspacing="0px" cellpadding="0px" border="0">
            <tr><td id="headerTitle"><h1>Certus Investments</h1></td></tr>
            <tr><td id="headerGraphic"><img id="headerGraphic" src="images/headerGraphic.gif" alt=""/></td></tr>
            <tr><td class="horizontalSpacer"></td></tr>
            <tr>
              <td>
                <!-- Start the nav menu-->
                <table id="headerMenu" cellspacing="0px" cellpadding="0px">
                  <tr>
                    <td class="menuItem" width="120">&#160;</td>
                    <td class="smallVerticalSpacer"></td>
                    <td class="menuItem"><a class="menuItemLink" href="" target="">HOME</a></td>
                    <td class="verticalSpacer"></td>
                    <td class="menuItem"><a class="menuItemLink" href="" target="">BACKGROUND</a></td>
                    <td class="verticalSpacer"></td>
                    <td class="menuItem"><a class="menuItemLink" href="" target="">STRATEGIES</a></td>
                    <td class="verticalSpacer"></td>
                    <td class="menuItem"><a class="menuItemLink" href="" target="">PERFORMANCE</a></td>
                    <td class="verticalSpacer"></td>
                    <td class="menuItem"><a class="menuItemLink" href="" target="">CONTACT</a></td>
                    <td class="smallVerticalSpacer"></td>
                    <td class="menuItem" width="120">&#160;</td>                  
                  </tr>
                </table>
              </td>
            </tr>
            <tr><td class="horizontalSpacer" colspan="9"></td></tr>
            </table>
          </td>
	</tr>
      <tr>
        <td>
          <table id="main" cellspacing="0px" cellpadding="0px" border="0">
            <tr>
              <td id="contactSmallPanel" valign="top">
                <table id="contactSmall" cellspacing="0px" cellpadding="3px" border="0">
                  <tr>
                    <td id="contactSmallTitle">
                      Contact Info
                    </td>
                  </tr>
                  <tr>
                    <td id="address">
                      1764 Church St. NW Ste. 3<BR />
                      Washington, DC 20036<BR />                                   
                      USA<BR />
                      <BR />
                    </td>
                  </tr>
                  
                  <tr>
                    <td id="contactSmallTitle">
                      News
                    </td>
                  </tr>
                  <tr>
                    <td id="news">
                      Official site launch October 2006.
                    </td>
                  </tr>
                </table>
              </td>
              <td class="verticalSpacer"></td>
              <td id="centerPanel" valign="top">
                <b>Certus Investments is an independent consultancy specializing in the research and development of quantitative financial market modelling and investment strategies.</b>
                
                <p>
                  For more details, please <a href="">register</a> or <a href="">contact us</a>.
                </p>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    
    <!-- Footer -->
    
    <table width="100%" id="footer" cellpadding="0" cellspacing="0" border="0" align="center">
      <tr>
	<td height="5"></td>
      </tr>
      <tr>
	<td align="center" width="100%">Copyright 2006 &#169; Certus Investments. All Rights Reserved.</td>
      </tr>
      <tr>
	<td height="5"></td>
      </tr>
      <tr>
	<!--<td>Please read our <a class="disclaimer" href="Disclaimer.jsp">Disclaimer</a> and <a class="disclaimer" href="PrivacyPolicy.jsp">Privacy Policy</a>.</td>-->
      </tr>
      <tr>
	<td height="9"></td>
      </tr>
    </table>
    <!-- Footer Ends -->
  </body>
</html>
]]>
    </rdf:value>    
  </template:Template>

  <server:PagePartHandler rdf:ID="css">
    <rdfs:label>Quant css</rdfs:label>
    <server:content_type>text/css</server:content_type>
    <rdf:value rdf:datatype="http://redfoot.net/2005/redfoot#Python">

TEMPLATE = redfoot.namespace("http://redfoot.net/2005/template#")

color = lookup(TEMPLATE.background_color) or "#cccccc"

response.write("""

body {
    margin: 0px;
    color: black;
    background-color: #C0C0C0;
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10px;
}


#boundary {
    width: 80%%;
    border: 1px solid white;
    color: black;
    background-color: #F8F8F8;
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10px;
}

#headerTitle {
   // border: medium none rgb(0,0,0);
    //background-color: white;
    background-color: #F8F8F8;
    //width: 100%%;
}


#header {
    border: medium none rgb(0,0,0);
    //background-color: white;
    background-color: #C0C0C0;
    width: 100%%;
}

#headerLogo {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 40px;
    height: 67px;
    padding: 0px 0px 0px 20px;
    color: rgb(62,114,141);
    //background-color: white;
    background-color: #C0C0C0;

}

#headerGraphic {
    width: 100%%;
    height: 90px;
    //background-color: #999999;
}

#headerMenu {
    width: 100%%;
    border: medium none rgb(0,0,0);
}

TD.menuItem {
    background-color: #999999;
    text-align: center;
}

TD.menuItem a {
font-family: Verdana, Arial, Helvetica, sans-serif;
font-size: 10px;
font-weight: normal;
text-align: center; 
text-decoration: none;
display: block;
color: white;
background-color:#999999;
margin:0px 0px 0px 0px;
padding:5px 10px 5px 10px;
}

TD.menuItem a:hover {
//color: #cc0000;
color: #000066;
}

TD.horizontalSpacer {
    height: 2px;
    background-color: white;
}

TD.verticalSpacer {
    width: 2px;
    background-color: white;
}

TD.smallVerticalSpacer {
    width: 1px;
    background-color: white;
}

#contactSmall {
    border: 1px solid #999999;
    color: black;
    background-color: #F8F8F8;
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10px;
    height: 150px;
}

#contactSmallPanel {
    width: 149px;
    border: medium none rgb(0,0,0);
    margin: 0px;
    padding: 20px 20px 20px 20px;
    color: black;
    //background-color: rgb(193,193,193);
}

#contactSmallTitle {
    margin: 0px;
    padding: 3px 3px 3px 3px;
    color: black;
    background-color: #999999;
    height: 20px;
    font-weight: bold;
    text-align: center
}

#narrowLeftPanel {
    width: 149px;
    border: medium none rgb(0,0,0);
    margin: 0px;
    padding: 20px 20px 20px 20px;
    color: black;
    background-color: rgb(159,185,198);
}

.leftPanelTitle {
    font-weight: bold;
    color:  rgb(62,114,141);
}


#address{
    text-align: center;
}



#centerPanel {
    width: 470px;
    border: medium none rgb(0,0,0);
    margin: 0px;
    padding: 20px 50px 20px 50px;
    color: black;
    background-color: #F8F8F8;
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10px;
}


#footer {
    margin: 0px;
    color: #999999;
    background-color: #C0C0C0;
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10px;
}

H1 {   
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 40px;

    font-weight: normal;
    height: 67px;
    padding: 0px 0px 0px 20px;
    color: #000066;
    //background-color: white;
    margin: 0em;
    // padding 0em;
}
     

A {
    color: #999999;
    font-weight: bold;
    text-decoration: none;
}                           

A:hover {
    //color: #CC0000;
    color: #000066;
}                        

""" % {"color": color})
    
    </rdf:value>
  </server:PagePartHandler>

</rdf:RDF>
