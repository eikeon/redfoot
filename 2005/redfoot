<?xml version="1.0"?>
<rdf:RDF 
  xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
  xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
  xmlns:redfoot="http://redfoot.net/2005/redfoot#"
  xmlns:template='http://redfoot.net/2005/template#'
  xmlns:server="http://redfoot.net/2005/server#"
>

  <redfoot:Namespace rdf:about="#">
    <rdfs:label>Redfoot</rdfs:label>
    <rdfs:comment>The core Redfoot namespace.</rdfs:comment>
  </redfoot:Namespace>

  <rdfs:Class rdf:ID="Resource">
    <rdfs:label>Redfoot Resource</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:subClassOf rdf:resource="http://www.w3.org/2000/01/rdf-schema#Resource"/>
  </rdfs:Class>

  <redfoot:Resource rdf:ID="Globals">
    <rdfs:label>Redfoot Globals</rdfs:label>
    <rdfs:comment></rdfs:comment>
  </redfoot:Resource>

  <redfoot:Resource rdf:ID="Defaults">
    <rdfs:label>Redfoot Defaults</rdfs:label>
    <redfoot:program rdf:resource="https://svn.redfoot.net/trunk/hypercode/kernel#"/>
  </redfoot:Resource>

  <rdfs:Class rdf:ID="Code">
    <rdfs:label>Code</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:subClassOf rdf:resource="#Resource"/>
  </rdfs:Class>

  <rdf:Property rdf:ID="code">
    <rdfs:label>code</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:range rdf:resource="#Code"/>
  </rdf:Property>

  <rdfs:Class rdf:ID="Program">
    <rdfs:label>Redfoot Program</rdfs:label>
    <rdfs:comment>
      A class of resources that can be used as a Redfoot program (run by a Redfoot Kernel).
    </rdfs:comment>
    <redfoot:todo>Add a redfoot:future term... subproperty of redfoot:todo?</redfoot:todo>
    <redfoot:future>Someday support kernel programs in other languages. For now we are limited to Python.</redfoot:future>
    <rdfs:subClassOf rdf:resource="#Code"/>
  </rdfs:Class>

  <rdf:Property rdf:ID="program"> <!-- TODO: relationship with REDFOOT.code ? -->
    <rdfs:label>program</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:domain rdf:resource="#Globals"/>
    <rdfs:range rdf:resource="#Program"/>
  </rdf:Property>

  <rdf:Property rdf:ID="init">
    <rdfs:label>init</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:domain rdf:resource="#Globals"/>
    <rdfs:range rdf:resource="#Program"/>
  </rdf:Property>

  <rdfs:Class rdf:ID="Module">
    <rdfs:label>Module</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:subClassOf rdf:resource="#Code"/>
    <rdf:value rdf:datatype="http://redfoot.net/2005/redfoot#Python">
<![CDATA[

# TODO check_cache bit
import logging, sys, types

_logger = logging.getLogger(__uri__)

module_name = this.__uri__       

_logger.debug("creating module: %s" % this.__uri__)
safe_module_name = "__uri___%s" % hash(this.__uri__)
module = types.ModuleType(safe_module_name)
module.__name__ = module_name 
module.__file__ = this.__uri__
module.__ispkg__ = 0
sys.modules[module_name] = module
module.__dict__.update(redfoot.globals)
this.execute(this.__uri__, context=module.__dict__)

for item in dir(module):
    _logger.info("setting: '%s'" % item)
    this.__setattr__(item, module.__dict__.get(item))
#def getattr(name, default=None):
#    return module.__dict__.get(name, default)
#this.__getattr__ = getattr

]]>
    </rdf:value>
  </rdfs:Class>

  <rdfs:Class rdf:ID="Kernel">
    <rdfs:label>Redfoot Kernel</rdfs:label>
    <rdfs:comment>
      A class of resources that can be used as a Redfoot Kernel.
    </rdfs:comment>
    <rdfs:subClassOf rdf:resource="#Program"/>
  </rdfs:Class>

  <rdf:Property rdf:ID="base">
    <rdfs:label>base</rdfs:label>
    <rdfs:comment>indicated the base URI Redfoot is to resolve relative URI against</rdfs:comment>
    <rdfs:domain rdf:resource="#Globals"/>
    <rdfs:range rdf:resource="#Resource"/>
  </rdf:Property>

  <rdf:Property rdf:ID="version">
    <rdfs:label>version</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:domain rdf:resource="#Globals"/>
    <rdfs:range rdf:resource="#Program"/> 
  </rdf:Property>

  <rdfs:Class rdf:ID="Context">
    <rdfs:label>Context</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:subClassOf rdf:resource="#Resource"/>
    <template:content>
      <server:PagePartHandler rdf:ID="content_handler">
        <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid"><![CDATA[
<span xmlns:kid="http://purl.org/kid/ns#" kid:omit="">
<?python
from urllib import quote
from rdflib.util import uniq

cid = request.uri.abstract()
context = redfoot.get_context(cid)
REDFOOT = redfoot.namespace("http://redfoot.net/2005/redfoot#")
DC = redfoot.namespace("http://purl.org/dc/elements/1.1/")
DCTERMS = redfoot.namespace("http://purl.org/dc/terms/")
action = request.parameters.get("action", None)
if action=="reload":
    source = redfoot.value(cid, REDFOOT.source)
    if source:
        print "reloading: %s" % source
        redfoot.load(source, publicID=cid)
if action=="delete":
    print "Deleting:", cid
    redfoot.remove_context(cid)   

from urllib import quote
?>
  <p>Creator: ${redfoot.value(cid, DC.creator, any=True)}</p>
  <p>Length: ${len(context)}</p>
  <p>Source: ${",".join(redfoot.objects(cid, REDFOOT.source))}</p>
  <p>View: <a href="${request.relative('%s?content-type=%s' % (cid.defrag(), quote('application/rdf+xml')))}">RDF/XML</a></p>

<p>
<form method="POST" action="">
  <input type="submit" name="action" value="reload"/>
</form>
</p>

<p>
<form method="POST" action="">
  <input type="submit" name="action" value="delete"/>
</form>
</p>

<h3>Instances</h3>

<ul>
  <li kid:for="s in [s for s in uniq(context.subjects()) if isinstance(s, URIRef)]"><a href="${request.host}/;${s.concrete()}">${context.label(s, s)}</a></li>
</ul>  

</span>


      ]]></rdf:value>
      </server:PagePartHandler>
    </template:content>
  </rdfs:Class>

  <rdf:Property rdf:ID="source">
    <rdfs:label>source</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:domain rdf:resource="#Context"/>
  </rdf:Property>

  <rdf:Property rdf:ID="context_id">
    <rdfs:label>context_id</rdfs:label>
    <rdfs:comment>used by load; see load method on kernel for more info</rdfs:comment>
    <rdfs:domain rdf:resource="#Context"/>
  </rdf:Property>

  <rdf:Property rdf:ID="publicID">
    <rdfs:label>publicID</rdfs:label>
    <rdfs:comment>used by load; see load method on kernel for more info</rdfs:comment>
    <rdfs:domain rdf:resource="#Context"/>
  </rdf:Property>

  <rdfs:Class rdf:ID="DeletedContext">
    <rdfs:label>Deleted Context</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:subClassOf rdf:resource="#Context"/>
  </rdfs:Class>

  <rdfs:Class rdf:ID="Namespace">
    <rdfs:label>Namespace</rdfs:label>
    <rdfs:comment>A namespace</rdfs:comment>
    <rdfs:subClassOf rdf:resource="#Resource"/>
  </rdfs:Class>

  <rdf:Property rdf:ID="todo">
    <rdfs:label>todo</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:domain rdf:resource="http://www.w3.org/2000/01/rdf-schema#Resource"/>
    <rdfs:range rdf:resource="http://www.w3.org/2000/01/rdf-schema#Literal"/>
  </rdf:Property>

  <rdfs:Class rdf:ID="Checked">
    <rdfs:label>Checked uris</rdfs:label>
    <rdfs:comment></rdfs:comment>
  </rdfs:Class>

  <rdfs:Class rdf:ID="Aspect">
    <rdfs:label>Aspect</rdfs:label>
    <rdfs:comment>A context intended to align its publicID with an existing context as to augment it is some aspect. For example, the following command will add functionality to add/view comments to a site: redfoot load http://redfoot.net/hypercode/aspects/comments http://localhost:8080 "#comments_aspect"</rdfs:comment>
    <rdfs:subClassOf rdf:resource="#Context"/>
  </rdfs:Class>

  <rdfs:Datatype rdf:ID="Python">
    <rdfs:label>Python Code String</rdfs:label>
    <rdfs:comment></rdfs:comment>
  </rdfs:Datatype>

  <rdfs:Class rdf:ID="Admin">
    <rdfs:label>Admin</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:subClassOf rdf:resource="session#User"/>
  </rdfs:Class>

  <rdf:Property rdf:ID="admin">
    <rdfs:label>admin</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:range rdf:resource="session#User"/> <!-- or other agents or group-->
  </rdf:Property>

<!--
  <rdfs:Class rdf:ID="Class">
    <rdfs:label>Redfoot Class</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:subClassOf rdf:resource="http://www.w3.org/2000/01/rdf-schema#Class"/>
    <rdfs:subClassOf rdf:resource="#Resource"/>
  </rdfs:Class>
-->

  <rdf:Property rdf:ID="xmpp_id"> 
    <rdfs:label>xmpp_id</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:domain rdf:resource="#Globals"/>
    <rdfs:range rdf:resource="http://www.w3.org/2000/01/rdf-schema#Literal"/>
  </rdf:Property>

  <rdf:Property rdf:ID="xmpp_password"> 
    <rdfs:label>xmpp_password</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:domain rdf:resource="#Globals"/>
    <rdfs:range rdf:resource="http://www.w3.org/2000/01/rdf-schema#Literal"/>
  </rdf:Property>

  <rdf:Property rdf:ID="xmpp_host"> 
    <rdfs:label>xmpp_host</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:domain rdf:resource="#Globals"/>
    <rdfs:range rdf:resource="http://www.w3.org/2000/01/rdf-schema#Literal"/>
  </rdf:Property>

  <rdf:Property rdf:ID="xmpp_port"> 
    <rdfs:label>xmpp_port</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:domain rdf:resource="#Globals"/>
    <rdfs:range rdf:resource="http://www.w3.org/2000/01/rdf-schema#Literal"/>
  </rdf:Property>

</rdf:RDF>  
