<?xml version="1.0" encoding="UTF-8"?>
<rdf:RDF
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
   xmlns:rdfe="http://redfoot.net/rdf#"
   xmlns:redfoot="http://redfoot.net/2005/redfoot#"
   xmlns:commands="http://redfoot.net/2005/commands#"
   xmlns:server="http://redfoot.net/2005/server#"
   xmlns:template='http://redfoot.net/2005/template#'
   xmlns:aspect="http://redfoot.net/hypercode/aspect#"
>

  <rdfe:RDFXMLDocument rdf:about="">
  </rdfe:RDFXMLDocument>
  
  <aspect:Aspect rdf:ID="aspect">
    <rdfs:label>Browse</rdfs:label>
    <aspect:item rdf:resource="#browse_page"/>
  </aspect:Aspect>

  <server:Page rdf:ID="browse_page">
    <aspect:location>/browse/</aspect:location>
    <rdfs:label>Browse</rdfs:label>
    <rdfs:comment></rdfs:comment>
    <rdfs:member rdf:resource="http://redfoot.net/2005/comment#exclude"/>
    <template:default_section_rank>12.0</template:default_section_rank>
    <template:content rdf:resource="#browse"/>
  </server:Page>

  <server:PagePartHandler rdf:ID="browse">
    <rdfs:label>Browse</rdfs:label>
    <rdfs:comment>

Browse class Tree.

    </rdfs:comment>
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid"><![CDATA[

  <span xmlns:kid="http://purl.org/kid/ns#" kid:omit="">

<?python BROWSE = redfoot.namespace("http://redfoot.net/2005/browse#") ?>

<span kid:strip=""
  kid:def="display_class(uri, seen=None)">

<?python
skip = False

subclasses = set(redfoot.subclasses(uri))

for subclass in redfoot.subclasses(uri):
    for subsub in redfoot.subclasses(subclass):
        if subclass not in redfoot.subclasses(subsub):
            subclasses.remove(subsub)
_subclasses = []
for subclass in subclasses:
    label = redfoot.label(subclass) or subclass
    _subclasses.append((label, subclass))
_subclasses.sort()

if seen is None:
    seen = set()
seen.add(uri)

?>
<li>
    <a kid:if="isinstance(uri, URIRef)" 
       href="${request.relative(uri.concrete())}">${redfoot.label(uri, uri)}</a>
    <span kid:strip="" kid:if="isinstance(uri, BNode)">${redfoot.label(uri, uri)}</span>
</li>    

  <ul kid:for="label, subclass in _subclasses">

  <span kid:strip="" kid:if="subclass not in seen">
    ${display_class(subclass, seen=set(seen))}
  </span>              

  </ul>

</span>

${display_class(redfoot.value(request.uri, BROWSE.root) or RDFS.Resource)}

  </span>
      
]]>
    </rdf:value>
  </server:PagePartHandler>

  <server:PagePartHandler rdf:ID="typeless">
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid"><![CDATA[
  <span xmlns:kid="http://purl.org/kid/ns#" kid:omit="">
<?python

from rdflib.util import uniq

typeless = []
for subject in uniq(redfoot.subjects()):
    if not (subject, RDF.type, None) in redfoot:
        typeless.append(subject)
   
?>
  <ul>
    <li kid:for="uri in typeless">
      <a kid:if="isinstance(uri, URIRef)"
         href="${request.relative(uri.concrete())}">${uri}</a>
         
      <span kid:if="isinstance(uri, BNode)" kid:strip="">${uri}
      <ul>
        <li kid:for="s, p in redfoot.subject_predicates(uri)">${s}, ${p}</li>
      </ul>  
      </span>      
    </li>
  </ul>
      

  </span>
      
      ]]></rdf:value>
  </server:PagePartHandler>

</rdf:RDF>  
