<?xml version="1.0" encoding="UTF-8"?>
<rdf:RDF
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
   xmlns:rdfe="http://redfoot.net/rdf#"
   xmlns:redfoot="http://redfoot.net/2005/redfoot#"
   xmlns:commands="http://redfoot.net/2005/commands#"
   xmlns:server="http://redfoot.net/2005/server#"
>

  <server:PagePartHandler rdf:ID="v1">
    <rdfs:label>Browse</rdfs:label>
    <rdfs:comment>

Browse class Tree.

    </rdfs:comment>
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid"><![CDATA[

  <span xmlns:kid="http://purl.org/kid/ns#" kid:omit="">

<?python BROWSE = redfoot.namespace("http://redfoot.net/2005/browse#") ?>

<ul kid:def="display_class(uri, seen=None)">
  <span kid:if="not seen or uri not in seen">
    <?python
if seen is None:
    seen = set()
seen.add(uri)
?>
      <li kid:for="subclass in redfoot.subclasses(uri)">
        <a kid:if="isinstance(subclass, URIRef)" 
           href="${request.relative(subclass.concrete())}">${redfoot.label(subclass, subclass)}</a>
        <span kid:strip="" kid:if="isinstance(subclass, BNode)">${redfoot.label(subclass, subclass)}</span>
        ${display_class(subclass, seen=set(seen))}
      </li>
      <li kid:for="instance in redfoot.instances(uri)">
        <a kid:if="isinstance(instance, URIRef)"
           href="${request.relative(instance.concrete())}">${redfoot.label(instance, instance)}</a>
        <span kid:strip="" kid:if="isinstance(instance, BNode)">${redfoot.label(instance, instance)}</span>
      </li>
  </span>      
</ul>

${display_class(redfoot.value(request.uri, BROWSE.root) or RDFS.Resource)}

  </span>
      
]]>
    </rdf:value>
  </server:PagePartHandler>

  <server:PagePartHandler rdf:ID="browse">
    <rdfs:label>Browse</rdfs:label>
    <rdfs:comment>

Browse class Tree.

    </rdfs:comment>
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid"><![CDATA[

  <span xmlns:kid="http://purl.org/kid/ns#" kid:omit="">

<?python BROWSE = redfoot.namespace("http://redfoot.net/2005/browse#") ?>

<span kid:strip=""
  kid:def="display_class(uri, seen=None)">

<?python
skip = False
subclasses = set()
for subclass in redfoot.subclasses(uri):
    if (uri, RDFS.subClassOf, subclass) in redfoot:
        skip = True
    else:
        subclasses.add(subclass)

if seen is None:
    seen = set()
seen.add(uri)

?>
<li>
    <a kid:if="isinstance(uri, URIRef)" 
       href="${request.relative(uri.concrete())}">${redfoot.label(uri, uri)}</a>
    <span kid:strip="" kid:if="isinstance(uri, BNode)">${redfoot.label(uri, uri)}</span>
</li>    

  <ul kid:for="subclass in subclasses">

  <span kid:strip="" kid:if="subclass not in seen">
    ${display_class(subclass, seen=set(seen))}
  </span>              

  </ul>

</span>

${display_class(redfoot.value(request.uri, BROWSE.root) or RDFS.Resource)}

  </span>
      
]]>
    </rdf:value>
  </server:PagePartHandler>

  <server:PagePartHandler rdf:ID="typeless">
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid"><![CDATA[
  <span xmlns:kid="http://purl.org/kid/ns#" kid:omit="">
<?python

from rdflib.util import uniq

typeless = []
for subject in uniq(redfoot.subjects()):
    if not (subject, RDF.type, None) in redfoot:
        typeless.append(subject)
   
?>
  <ul>
    <li kid:for="uri in typeless">
      <a kid:if="isinstance(uri, URIRef)"
         href="${request.relative(uri.concrete())}">${uri}</a>
         
      <span kid:if="isinstance(uri, BNode)" kid:strip="">${uri}
      <ul>
        <li kid:for="s, p in redfoot.subject_predicates(uri)">${s}, ${p}</li>
      </ul>  
      </span>      
    </li>
  </ul>
      

  </span>
      
      ]]></rdf:value>
  </server:PagePartHandler>

</rdf:RDF>  
