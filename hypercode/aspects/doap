<?xml version="1.0" encoding="UTF-8"?>
<rdf:RDF
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
   xmlns:rdfe="http://redfoot.net/rdf#"
   xmlns:redfoot="http://redfoot.net/2005/redfoot#"
   xmlns:commands="http://redfoot.net/2005/commands#"
   xmlns:server="http://redfoot.net/2005/server#"
   xmlns:session="http://redfoot.net/2005/session#"
   xmlns:template='http://redfoot.net/2005/template#'
   xmlns:aspect="http://redfoot.net/hypercode/aspect#"
>

  <rdfe:RDFXMLDocument rdf:about="">
  </rdfe:RDFXMLDocument>
  
  <aspect:Aspect rdf:ID="aspect">
    <rdfs:label>Doap Aspect</rdfs:label>
    <redfoot:todo>Look into http://kupu.oscom.org/</redfoot:todo>
    <aspect:item rdf:resource="#contributors"/>
    <aspect:item rdf:resource="#releases"/>
  </aspect:Aspect>

  <template:Section rdf:ID="contributors">
    <aspect:location>/contributors/</aspect:location>
    <!-- Change page template to use abstract_uri's rdfs:label -->
    <!-- and have this override if present  -->
    <rdfs:label>Contributors</rdfs:label>
    <template:default_section_rank>70.0</template:default_section_rank>
    <template:content rdf:parseType="Resource">
      <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:kid="http://purl.org/kid/ns#">
<?python 
FOAF = redfoot.namespace("http://xmlns.com/foaf/0.1/")
DOAP = redfoot.namespace("http://usefulinc.com/ns/doap#")
project = URIRef("%s#" % request.host)
people = []
seen = set()
for property in [DOAP.maintainer, DOAP.developer, DOAP.documenter, DOAP.translator, DOAP.tester, DOAP.helper]:
    for person in redfoot.objects(project, property):
        if person not in seen:
            seen.add(person)
            label = redfoot.label(person) or person
            relationships = set()
            for relationship in redfoot.predicates(project, person):
                relationships.add(redfoot.label(relationship))
            people.append((label, person, relationships))

people.sort()
?>

<ul>
  <li kid:for="label, person, relationships in people">
    <a href="${redfoot.value(person, FOAF.homepage)}">${label}</a>, 
    ${redfoot.value(person, FOAF.nick, any=True)},
    (${", ".join(relationships)})
  </li>
</ul>

</div>
]]>    
      </rdf:value>      
    </template:content>
  </template:Section>


  <template:Section rdf:ID="releases">
    <aspect:location>/releases/</aspect:location>
    <!-- Change page template to use abstract_uri's rdfs:label -->
    <!-- and have this override if present  -->
    <rdfs:label>Releases</rdfs:label>
    <template:default_section_rank>50.0</template:default_section_rank>
    <template:content rdf:parseType="Resource">
      <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:kid="http://purl.org/kid/ns#">
<?python 
DOAP = redfoot.namespace("http://usefulinc.com/ns/doap#")
format = redfoot.module(URIRef("modules/simple_format#module", base=redfoot_program)).format
format_uri = redfoot.module(URIRef("modules/simple_format#module", base=redfoot_program)).format_uri
project = request.host.abstract()
releases = []
for release in redfoot.objects(project, DOAP.release):
    created = redfoot.value(release, DOAP.created)
    releases.append((created, release))
releases.sort()
releases.reverse()
?>

    <ul>
     <span kid:strip="" kid:for="created, release in releases">
      <li>${XML(format_uri(release))} (${created})</li>
     </span>
    </ul>


</div>
    
]]>    
      </rdf:value>      
    </template:content>
  </template:Section>


  <rdf:Description rdf:about="http://usefulinc.com/ns/doap#Project">
    <template:content rdf:parseType="Resource">
      <rdfs:label>Default main for Redfoot</rdfs:label>      
      <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:kid="http://purl.org/kid/ns#"
>
<?python
DOAP = redfoot.namespace("http://usefulinc.com/ns/doap#")
format = redfoot.module(URIRef("modules/simple_format#module", base=redfoot_program)).format
format_uri = redfoot.module(URIRef("modules/simple_format#module", base=redfoot_program)).format_uri
# releases = []
# for release in redfoot.objects(request.uri.abstract(), DOAP.release):
#     created = redfoot.value(request.uri.abstract(), DOAP.created)
#     releases.append((created, release))
# releases.sort()
# releases.reverse()
seeAlsoList = redfoot.objects(request.uri.abstract(), RDFS.seeAlso)
?>

  <p>${XML(format_uri(request.uri.abstract(), DOAP.description))}</p>
  


  <div style="float: right; width: 40%">
<!--
  <div>Download:
      <ul>
      <li kid:for="download_page in redfoot.objects(request.uri.abstract(), getattr(DOAP, 'download-page'))">
        ${XML(format_uri(download_page))}
      </li>
      </ul>
  </div>
-->
  <div>Browse: ${XML(format_uri(request.uri.abstract(), DOAP.SVNRepository))}</div>
  
  <div>Send feedback to: ${XML(format_uri(request.uri.abstract(), DOAP.maintainer))}</div>
  </div>

<!--
  <div class="recipe" style="width: 50%">
  <h2>Releases</h2>  
    <dl>
     <span kid:strip="" kid:for="created, release in releases[0:3]">
      <dt>${XML(format_uri(release))}</dt>
<?python
content_value = redfoot.comment(release)
content_type = content_value.datatype
?>
      <dd kid:if="content_type=='http://www.w3.org/1999/xhtml'">${XML(content_value)}</dd>
      <dd kid:if="content_type!='http://www.w3.org/1999/xhtml'">${XML(format_uri(content_value))}</dd>
     </span>
    </dl>
  </div>
-->  
  
  <div kid:if="seeAlsoList">
  <h2>See Also</h2>
  <ul>
    <li kid:for="seeAlso in seeAlsoList">${XML(format_uri(seeAlso))}</li>
  </ul>
  </div>    

  <br style="clear: both"/>

</div>
]]>
      </rdf:value>
    </template:content>
  </rdf:Description>

  <rdf:Description rdf:about="http://usefulinc.com/ns/doap#Version">
    <template:content rdf:parseType="Resource">
      <rdfs:label>Default main for Redfoot</rdfs:label>      
      <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:kid="http://purl.org/kid/ns#"
>
<?python
release = request.uri.abstract()

DOAP = redfoot.namespace("http://usefulinc.com/ns/doap#")
format = redfoot.module(URIRef("modules/simple_format#module", base=redfoot_program)).format
format_uri = redfoot.module(URIRef("modules/simple_format#module", base=redfoot_program)).format_uri

content_value = redfoot.comment(release)
content_type = content_value.datatype
?>

  <p kid:if="content_type=='http://www.w3.org/1999/xhtml'">${XML(content_value)}</p>
  <p kid:if="content_type!='http://www.w3.org/1999/xhtml'">${content_value}</p>
  

</div>
]]>
      </rdf:value>
    </template:content>
  </rdf:Description>

</rdf:RDF>  
