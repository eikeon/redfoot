<?xml version="1.0" encoding="utf-8"?>
<rdf:RDF
  xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns#'
  xmlns:rdfs='http://www.w3.org/2000/01/rdf-schema#'
  xmlns:redfoot='http://redfoot.net/2005/redfoot#'
  xmlns:server='http://redfoot.net/2005/server#'
  xmlns:template='http://redfoot.net/2005/template#'  
>

  <redfoot:Aspect rdf:about="#ajar_aspect">
    <rdfs:label>ajar based Editor</rdfs:label>
    <template:section rdf:resource="/edit/ajar/"/>
    <rdfs:seeAlso rdf:resource="http://www.w3.org/2005/ajar/"/>
  </redfoot:Aspect>

  <server:Page rdf:about="/edit/ajar/">  
    <template:head rdf:resource="#ajar_head"/>
    <template:content>
      <server:PagePartHandler rdf:ID="ajar_content">
        <rdfs:label>ajar content</rdfs:label>
        <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns:kid="http://purl.org/kid/ns#"  kid:strip="">

  <form name="AddressBar" onsubmit="void GotoFormURI()" action=""
  id="AddressBar">
    URI: <input type="text" name="UserURI" size="80"/> <input type=
    "button" onclick="GotoFormURI()" value="Add to outliner"/>
    <a class="menu" href="Help.html">Help</a> <a class="menu" href=
    "About.html">About</a>
  </form>

  <div onmousedown="TabulatorMousedown(event)" ondblclick=
  "TabulatorDoubleClick(event)">
    <table id="browser">
      <tr>
        <td about=
        "&lt;http://www.w3.org/2005/04/swls/BioDash/Demo/gsk&gt;">
        <img border="0" src="icons/tbl-expand-trans.png" alt=
        "expand"/> <img border="0" src="icons/16dot-blue.gif" alt=
        "fetch"/> Life Scienecs demo data: GSK3-Beta Drug
        Target</td>
      </tr>
    </table>
  </div>

  <div id="key">
    &nbsp;Key: Data: <img src="icons/16dot-blue.gif" alt="fetch"/>
    fetch data. <img src="icons/16dot-yellow.gif" alt="requested"/>
    loading. <img src="icons/16dot-red.gif" alt="failed"/> failed.
    <img src="icons/16dot-green.gif" alt="loaded"/> loaded.
    &nbsp;&nbsp;&nbsp; Display: <img src=
    "icons/tbl-expand-trans.png" alt="expand"/> expand, <img src=
    "icons/tbl-collapse.png" alt="collapse"/> collapse,
  </div>
  <hr/>

  <form name="TabulateForm" onsubmit="void 0" action="" id=
  "TabulateForm">
    <input type="button" onclick="void AJAR_Tabulate()" value=
    "Tabulate selected properties"/> <a class="menu" href=
    "Help.html">Help</a> <a class="menu" href=
    "About.html">About</a>
  </form>

  <div id="results"></div>
  <hr/>

  <h3>Sources</h3>

  <table id="sources"><tr><td></td></tr></table>

  <div id="log">
    <hr/>

    <h3>Log</h3><span onmousedown="setLogging(true)">[turn logging
    on]</span> <span onmousedown="setLogging(false)">[turn logging
    off]</span> <span onmousedown="clearStatus()">[clear
    log]</span> <span onmousedown="dumpStore()">[dump store to
    log]</span><br/>
    <hr/>
    <pre id="status">
<br/>
</pre><span onmousedown="setLogging(true)">[turn logging on]</span>
<span onmousedown="setLogging(false)">[turn logging off]</span>
<span onmousedown="clearStatus()">[clear log]</span>
<span onmousedown="dumpStore()">[dump store to log]</span><br/>
  </div>
</div>
]]>
        </rdf:value>
      </server:PagePartHandler>
    </template:content>
  </server:Page>

  <server:PagePartHandler rdf:ID="ajar_head">
    <rdfs:label>Default head</rdfs:label>
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns:kid="http://purl.org/kid/ns#"
     kid:strip="">
<?python
title = redfoot.label(request.uri, None) or redfoot.label(request.uri.abstract(), None) or "-"
?>
  <head>
    <title>${redfoot.label(request.host)}: ${title}</title>
    <meta http-equiv="Content-Type" content="text/xhtml; charset=UTF-8"/>
    <meta name="keywords" content=""/>
    <link rel="shortcut icon" href="${lookup(TEMPLATE.shortcut_icon)}"/>
    <style type="text/css">
      ${display(lookup(TEMPLATE.css))}
    </style>
    <span kid:for="alternate in redfoot.objects(request.uri, SERVER.alternate)" kid:strip="" >
    <link rel="alternate"
      href="${alternate}" title="${redfoot.label(alternate)}"
      type="${redfoot.value(alternate, SERVER.content_type)}" />
    </span> 

  <link rel="stylesheet" href="dynamic.css" type="text/css"/>

<script src="rdf/uri.js" type="text/javascript">
</script>
<script src="rdf/term.js" type="text/javascript">
</script>
<script src="rdf/match.js" type="text/javascript">
</script>
<script src="rdf/parser.js" type="text/javascript">
</script>
<script src="rdf/identity.js" type="text/javascript">
</script>
<script src="rdf/query.js" type="text/javascript">
</script>
<script src="tabulate.js" type="text/javascript">
</script>

  </head>
</div>
]]>
    </rdf:value>
  </server:PagePartHandler>

  <!-- 
NOTE: http://redfoot.net/hypercode/types/static_page or somesuch has
to be loaded.

And you'll need to have the corresponding files in a html subdirectory of your redfoot's CWD.

TODO: It'd be nice to have a tool to install these resouces into the
hypercode instead of leaving them external to it.
  -->

<!--
  <server:StaticPage rdf:about="/rdf/identity.js"/>
  <server:StaticPage rdf:about="/rdf/match.js"/>
  <server:StaticPage rdf:about="/rdf/parser.js"/>
  <server:StaticPage rdf:about="/rdf/query.js"/>
  <server:StaticPage rdf:about="/rdf/term.js"/>
  <server:StaticPage rdf:about="/rdf/uri.js"/>
  <server:StaticPage rdf:about="/tabulate.js"/>
  <server:StaticPage rdf:about="/dynamic.css">
    <server:content_type>text/css</server:content_type>
  </server:StaticPage>

  <server:StaticPage rdf:about="/icons/16dot-blue.gif"/>
  <server:StaticPage rdf:about="/icons/16dot-green.gif"/>
  <server:StaticPage rdf:about="/icons/16dot-red.gif"/>
  <server:StaticPage rdf:about="/icons/16dot-yellow.gif"/>
  <server:StaticPage rdf:about="/icons/document.png"/>
  <server:StaticPage rdf:about="/icons/tbl-collapse.png"/>
  <server:StaticPage rdf:about="/icons/tbl-expand-trans.png"/>
-->

  <server:Page rdf:about="/resource">
    <rdfs:label>resource</rdfs:label>
    <rdfs:comment>Return all the known statements about the given URIRef</rdfs:comment>
    <server:page_handler>
      <redfoot:Python rdf:about="resource_code">
        <server:content_type>application/rdf+xml</server:content_type>      
        <rdf:value rdf:datatype="http://redfoot.net/2005/redfoot#Python"><![CDATA[

uri = URIRef(request.parameters.get("uri", None))

# TODO support BNode identifiers

from rdflib.Graph import Graph
out = Graph()

# Include all statements about uri. And any statement about one of the
# objects in those statements.
for s, p, o in redfoot.triples((uri, None, None)):
    out.add((s, p, o))
    if isinstance(o, (URIRef, BNode)):
        for t in redfoot.triples((o, None, None)):
            out.add(t)

# Include all info from context corresponding to URIRef
cid = redfoot.context_id(uri)
g = redfoot.get_context(cid)
out += g

out.serialize(destination=response)

      ]]></rdf:value>
      </redfoot:Python>
    </server:page_handler>
  </server:Page>

</rdf:RDF>
