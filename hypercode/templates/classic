<?xml version="1.0" encoding="UTF-8"?>
<rdf:RDF
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
   xmlns:redfoot="http://redfoot.net/2005/redfoot#"
   xmlns:template="http://redfoot.net/2005/template#"
   xmlns:server="http://redfoot.net/2005/server#"
>

  <template:Template rdf:ID="page">
    <rdfs:label>Classic Template</rdfs:label>
    <template:content rdf:resource="#content"/>
    <template:background_color>#B0C9BE</template:background_color>
    <template:css rdf:resource="#css"/>
    <template:title rdf:resource="#title"/>
    <template:shortcut_icon rdf:resource="http://redfoot.net/2002/11/25/favicon.ico"/>
    <template:header rdf:resource="#header"/>
    <template:navigation rdf:resource="#navigation"/>
    <template:footer rdf:resource="#footer"/>
    <server:unauthorized_content_handler rdf:resource="#unauthorized_content_handler"/>
    <server:content_type>application/xhtml+xml</server:content_type>
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:kid="http://purl.org/kid/ns#">
<?python SERVER = redfoot.namespace("http://redfoot.net/2005/server#")?>
<?python TEMPLATE = redfoot.namespace("http://redfoot.net/2005/template#")?>
  <head>
    <title>${redfoot.label(request.host)}: ${display(lookup(TEMPLATE.title))}</title>
    <meta http-equiv="Content-Type" content="text/xhtml; charset=UTF-8"/>
    <meta name="keywords" content=""/>
    <link rel="shortcut icon" href="${lookup(TEMPLATE.shortcut_icon)}"/>
    <style type="text/css">
      ${display(lookup(TEMPLATE.css))}
    </style>
    <span kid:for="alternate in redfoot.objects(request.uri, SERVER.alternate)" kid:strip="" >
    <link rel="alternate"
      href="${alternate}" title="${redfoot.label(alternate)}"
      type="${redfoot.value(alternate, SERVER.content_type)}" />
    </span> 
  </head>

  <body>


<div id="container">

  <div id="usernav">

<ul>
  <!-- TODO: -->
  <?python edit_uri = URIRef('%s/edit/content/' % request.host)?>
  <li kid:if="(edit_uri, None, None) in redfoot and allow(URIRef('%s/edit/resource' % request.host))"
       id="edit_page">
   <?python from urllib import quote?>
    <a kid:if="(request.uri, None, None) in redfoot" href="/edit/resource?uri=${quote(request.uri)}">Edit Page</a>
    <a kid:if="(request.uri.abstract(), None, None) in redfoot" href="/edit/resource?uri=${quote(request.uri.abstract())}">Edit Page (abstract)</a>
  </li>

<?python
SESSION = redfoot.namespace("http://redfoot.net/2005/session#")
FOAF = redfoot.namespace("http://xmlns.com/foaf/0.1/")
authenticated = request.session_id and (request.session_id, SESSION.authenticated, Literal('True')) in redfoot
if authenticated:
    uid = redfoot.value(request.session_id, SESSION.uid)
else:
    uid = None
?>
 <span kid:if="uid is None" kid:strip="">
  <li><a href="/login/">Login</a></li>
  <li><a href="/register/">Register</a></li>
 </span>
 <span kid:if="uid" kid:strip="">
  <li><a href="${request.relative(uid.concrete())}">${redfoot.label(uid) or uid}'s profile</a></li>
  <li><a href="/logout/">logout</a></li>
 </span>
</ul>

  </div>

  <div id="top">
    ${display(lookup(TEMPLATE.header))}
  </div>


  <div id="sitenav">
    ${display(lookup(TEMPLATE.navigation))}
  </div>

  <div id="content">

      <!-- TODO: -->
      <?python edit_content_uri = URIRef('%s/edit/content/' % request.host)?>
      <div kid:if="(edit_content_uri, None, None) in redfoot and allow(edit_content_uri)"
           id="edit_content">
       <?python from urllib import quote?>
        <a kid:if="(request.uri, None, None) in redfoot" href="/edit/content/?uri=${quote(request.uri)}">Edit Content</a>
        <a kid:if="(request.uri, None, None) not in redfoot" href="/edit/content/?uri=${quote(request.uri)}">Create</a>
      </div>

      <h2><a href="${request.uri}">${display(lookup(TEMPLATE.title))}</a></h2>

      ${display(lookup(TEMPLATE.content))}

      <?python COMMENT = redfoot.namespace("http://redfoot.net/2005/comment#")?>
      <div class="comments"
           kid:if="lookup(TEMPLATE.comments) and (request.uri, RDFS.member, COMMENT.exclude) not in redfoot">
        ${display(lookup(TEMPLATE.comments))}
        ${display(lookup(TEMPLATE.add_comment))}
      </div>

  </div>
  <div id="footer">
    ${display(lookup(TEMPLATE.footer))}
  </div>
</div>

  </body>
</html>
]]>
    </rdf:value>    
  </template:Template>

  <server:PagePartHandler rdf:ID="title">
    <rdfs:label>classic title</rdfs:label>
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns="http://www.w3.org/1999/xhtml" xmlns:kid="http://purl.org/kid/ns#" kid:strip="">
<?python
types = []
for type in redfoot.objects(request.uri, RDF.type):
    label = redfoot.label(type)
    if label:
        types.append(label)
if not types:
    for type in redfoot.objects(request.uri.abstract(), RDF.type):
        label = redfoot.label(type)
        if label:
            types.append(label)
types.sort()
label = redfoot.label(request.uri, None) or redfoot.label(request.uri.abstract(), None)
title = "%s (%s)" % (label, ", ".join(types))
?>${title}</div>]]>
    </rdf:value>    
  </server:PagePartHandler>

  <server:PagePartHandler rdf:ID="header">
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns:kid="http://purl.org/kid/ns#" kid:strip="">

<h1><a href="${request.host}">${redfoot.label(request.host) or request.host}</a></h1></div>]]>
    </rdf:value>    
  </server:PagePartHandler>

  <server:PagePartHandler rdf:ID="footer">
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid"><![CDATA[
      <div xmlns:kid="http://purl.org/kid/ns#" kid:strip="">
        <a href="http://redfoot.net/">redfoot.net</a>
      </div>
      ]]></rdf:value>
  </server:PagePartHandler>

  <server:PagePartHandler rdf:ID="navigation">
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid"><![CDATA[

<div class="nav" xmlns:kid="http://purl.org/kid/ns#">
<?python
TEMPLATE = redfoot.namespace("http://redfoot.net/2005/template#")
sections = []
for section in redfoot.objects(request.host, TEMPLATE.section):
    label = redfoot.value(section, TEMPLATE.section_name) or redfoot.label(section)
    try:
        val = redfoot.value(section, TEMPLATE.section_rank)
        if val is None:
            val = redfoot.value(section, TEMPLATE.default_section_rank, any=True)            
        rank = float(val)
    except:
        rank = 0.0
    if allow(section):
        sections.append((rank, label, section))
sections.sort()
?>
  <ul kid:if="sections" id="navlist">
    <li kid:for="rank, label, section in sections">
      <a href="${section}" id="${section==request.uri and 'current' or None}">${label}</a>
    </li>
  </ul>  
</div>
    
      ]]></rdf:value>
  </server:PagePartHandler>


  <server:PagePartHandler rdf:ID="css">
    <rdfs:label>Default css</rdfs:label>
    <server:content_type>text/css</server:content_type>
    <rdf:value rdf:datatype="http://redfoot.net/2005/redfoot#Python">

TEMPLATE = redfoot.namespace("http://redfoot.net/2005/template#")

color = lookup(TEMPLATE.background_color) or "#cccccc"

response.write("""

html {
    background-color: %(color)s;
    background: %(color)s url("http://redfoot.net/2005/fade-in-light.png") top left repeat-x;
}

body {
    margin: 0.5em 1em;
    padding: 0em;
    font-family: arial, helvetica, sans-serif;
}

pre {
  background-color: #eeeeee;
  border: 1px solid black;
  padding: 0.5em 1em;
  white-space: pre; /* CSS2 */
  white-space: -moz-pre-wrap; /* Mozilla */
  white-space: -hp-pre-wrap; /* HP printers */
  white-space: -o-pre-wrap; /* Opera 7 */
  white-space: -pre-wrap; /* Opera 4-6 */
  white-space: pre-wrap; /* CSS 2.1 */
  white-space: pre-line; /* CSS 3 (and 2.1 as well, actually) */
  word-wrap: break-word; /* IE */
}

#container {
    width: 100%%;
    margin: 10px auto;
    background-color: transparent;
}

#top h1 {
    padding: 0;
    margin: 0;
    display: inline;
}

#sitenav {
    xwidth: 100%%;
    margin: 0px;
    padding: 0em;
    background-color: transparent;
}

#navlist {
    margin: 0;
    margin-top: 0.5em;
    xmargin-right: 160px;
    padding: 0;
    font-size: smaller;
}

#navlist ul {
    list-style-type: none;
}

#navlist li {
    display: inline;
    margin: 0 1em 0px 0;
}

#navlist a {    
    padding: 0.2em 0.5em 1px 0.5em;
}

#navlist a:link#current, #navlist a:visited#current {
    background-color: #fff;
    border: 1px solid black;
    border-bottom: 1px solid white;
}

#navlist a:hover {
}

#content {
    margin: 0px;
    margin-left: 0px;
    xmargin-right: 160px;

    padding: 1em;

    border: 1px solid black;

    background-color: #ffffff;
    background: #ffffff url("http://redfoot.net/2005/fade-out.png") bottom left repeat-x;

    min-height: 400px;
    min-width: 200px;
    //max-width: 36em;
}

#footer {
    clear: both;
    margin: 0;
    padding: .5em;
    color: #333;
    background-color: transparent;
}

#content h2 { margin: 0 0 .5em 0; }

#edit_page {}
#edit_content {float: right;}

#usernav {
    float: right;
    background-color: transparent;
}

#usernav ul {
    margin: 0;
    padding: 0;
    display: inline;
    list-style: none;
}

#usernav li {
    display: inline;
    margin: 0;
    padding: 0;
}

#usernav li a, #header li a:visited {
    display: inline;
    font-weight: bold;
    padding: 0 1.5em;
    font-size: 0.6em;
    xfont-size: small;
}

a {
    color: #000000;
    font-weight: bold;
    text-decoration: none
}

#content a {
    border-bottom: 1px dotted #fc6305;
}

a:hover {
    color: #fc6305;
    font-weight: bold;
    text-decoration: none
}


""" % {"color": color})
    
    </rdf:value>
  </server:PagePartHandler>

  <server:PagePartHandler rdf:ID="unauthorized_page_handler">
    <rdfs:label>Unauthorized page handler</rdfs:label>
    <rdf:value rdf:datatype="http://redfoot.net/2005/redfoot#Python">
<![CDATA[
response.setStatus(401, "Unauthorized")            
response.write("""
<h1>Unauthorized</h1>
""")        
    
]]>
    </rdf:value>
  </server:PagePartHandler>

  <server:PagePartHandler rdf:ID="unauthorized_content_handler">
    <rdfs:label>Unauthorized page handler</rdfs:label>
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns:kid="http://purl.org/kid/ns#"
     kid:strip="">
<h2>Unauthorized Content</h2>
</div>
]]>
    </rdf:value>
  </server:PagePartHandler>

  <server:PagePartHandler rdf:ID="content">
    <rdfs:label>Generic Display of Resource</rdfs:label>
    <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns:kid="http://purl.org/kid/ns#"
     kid:strip=""
>
<?python
if (request.uri.abstract(), None, None) in redfoot:
    uri = request.uri.abstract()
elif (request.uri, None, None) in redfoot:
    uri = request.uri
else:
    uri = request.uri.abstract()
    
simple_format = URIRef("modules/simple_format#module", base=redfoot_program)
format_uri = redfoot.module(simple_format).format_uri
seeAlsoList = list(redfoot.objects(uri, RDFS.seeAlso))

miscList = [t for t in redfoot.predicate_objects(uri) if t[0] not in [RDFS.label, RDFS.comment, RDF.type, RDFS.seeAlso]]

?>

  <h2 kid:if="(uri, None, None) not in redfoot">Not Found</h2>

  <p>${XML(format_uri(redfoot.comment(uri)))}</p>
  
  <ul>
    <li kid:for="p, o in miscList">${redfoot.label(p) or p},
      <span kid:strip="" kid:if="isinstance(o, Literal)">
        <pre>${o}</pre>
      </span>
      <span kid:strip="" kid:if="isinstance(o, URIRef)">      
        <a href="${request.host}/;${o.concrete()}">
          ${", ".join(redfoot.objects(o, RDFS.label)) or o}
        </a>
      </span>
      <span kid:strip="" kid:if="isinstance(o, BNode)">
        ${", ".join(redfoot.objects(o, RDFS.label))}      
      </span>      
    </li>
  </ul>


  <div kid:if="seeAlsoList">
  <h2>See Also</h2>
  <ul>
    <li kid:for="seeAlso in seeAlsoList">${XML(format_uri(seeAlso))}</li>
  </ul>
  </div>    
</div>
]]>
    </rdf:value>
  </server:PagePartHandler>

</rdf:RDF>  
