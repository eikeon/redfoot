<?xml version="1.0" encoding="UTF-8"?>
<rdf:RDF
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
   xmlns:redfoot="http://redfoot.net/2005/redfoot#"
   xmlns:server="http://redfoot.net/2005/server#"
   xmlns:template="http://redfoot.net/2005/template#"
>

  <rdfs:Class rdf:about="http://www.w3.org/2000/01/rdf-schema#Class">
    <template:content>
      <server:PagePartHandler rdf:ID="class_content">
        <rdfs:label>Display of Class</rdfs:label>
        <rdf:value rdf:datatype="http://redfoot.net/2005/server#Kid">
<![CDATA[
<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:kid="http://purl.org/kid/ns#"
     kid:strip=""
>
<?python
if (request.uri.abstract(), None, None) in redfoot:
    uri = request.uri.abstract()
elif (request.uri, None, None) in redfoot:
    uri = request.uri
else:
    uri = request.uri.abstract()
    
format = redfoot.module(URIRef("modules/simple_format#module", base=redfoot_program)).format
format_uri = redfoot.module(URIRef("modules/simple_format#module", base=redfoot_program)).format_uri

seeAlsoList = list(redfoot.objects(uri, RDFS.seeAlso))

miscList = [t for t in redfoot.predicate_objects(uri) if t[0] not in [RDFS.label, RDFS.comment, RDF.type, RDFS.subClassOf, RDFS.seeAlso]]

instances = []
seen = set()
for instance in redfoot.instances(uri):
    if instance not in seen and isinstance(instance, URIRef):
        seen.add(instance)
        label = redfoot.value(instance, RDFS.label, any=True)
        label = label or instance
        instances.append((label, instance))
instances.sort()

subclasses = list(redfoot.subclasses(uri))
superclasses = list(redfoot.objects(uri, RDFS.subClassOf)) # TODO:

?>

  <h2 kid:if="(uri, None, None) not in redfoot">Not Found</h2>

  <p>${XML(format_uri(redfoot.comment(uri)))}</p>
  
  <div kid:if="superclasses">superclasses: <span kid:strip="" kid:for="superclass in superclasses"><a href="${request.relative(superclass.concrete())}">${redfoot.label(superclass, superclass)}</a> </span></div>
  <div kid:if="subclasses">subclasses: <span kid:strip="" kid:for="subclass in subclasses"><a href="${request.relative(subclass.concrete())}">${redfoot.label(subclass, subclass)}</a> </span></div>

  
  <ul kid:if="miscList">
    <li kid:for="p, o in miscList">${redfoot.label(p) or p},
      <span kid:strip="" kid:if="isinstance(o, Literal)">
        <pre>${o}</pre>
      </span>
      <span kid:strip="" kid:if="isinstance(o, URIRef)">      
        <a href="${request.relative(o.concrete())}">
          ${", ".join(redfoot.objects(o, RDFS.label)) or o}
        </a>
      </span>
      <span kid:strip="" kid:if="isinstance(o, BNode)">
        ${", ".join(redfoot.objects(o, RDFS.label))}      
      </span>      
    </li>
  </ul>


  <div kid:if="seeAlsoList">
  <h2>See Also</h2>
  <ul>
    <li kid:for="seeAlso in seeAlsoList">${XML(format_uri(seeAlso))}</li>
  </ul>
  </div>    

  <div kid:if="instances">
  <dl> 
    <span kid:strip="" 
          kid:for="label, instance in instances">
      <dt kid:if="isinstance(instance, URIRef)">      
        <a href="${request.relative(instance.concrete())}">
          ${label}
        </a>
      </dt>
      <dt kid:if="isinstance(instance, BNode)">
        ${label}      
      </dt>      
      <dd>
        ${XML(format(redfoot.comment(instance)))}
      </dd>
    </span>
  </dl>
  
  </div>

  <p kid:if="allow(URIRef('%s/create/' % request.host))">
    <form name="create_form" action="/create/" method="POST">
      <input name="type" type="hidden" value="${request.uri.abstract()}"/>
      <input type="submit" value="Create Instance"/>                       
    </form>
  </p>

</div>
]]>
        </rdf:value>
      </server:PagePartHandler>
    </template:content>
  </rdfs:Class>

</rdf:RDF>  
